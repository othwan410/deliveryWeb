{% extends 'layout.html' %} {% block content %}
<div id="profile-box">
  <div id="profile-info">
    <label for=""
      ><span>이메일</span
      ><input type="text" value="{{user.account}}" readonly /></label
    ><br />
    <label for=""
      ><span>닉네임</span
      ><input id="nickname" type="text" value="{{user.nickname}}" readonly
    /></label>
    <button id="mdf-btn">수정</button><br />
    <label for=""
      ><span>포인트</span
      ><input type="text" value="{{user.point}}" readonly /></label
    ><br />
  </div>
  <div>
    <a href="/myDibs"><button>찜</button></a>
    <button>리뷰</button><br />
    <button id="logout">로그아웃</button>
    <button id="delete">탈퇴</button><br />
    <input
      id="pwd-check"
      type="text"
      style="display: none"
      placeholder="비밀번호"
    />
    <button id="check-btn" style="display: none">확인</button>
  </div>
</div>
{% endblock %} {% block script %}
<script>
  modify();

  $(document).on('click', '#delete', async function () {
    $('#pwd-check').css('display', 'block');
    $('#check-btn').css('display', 'block');
  });

  $(document).on('click', '#check-btn', async function () {
    const password = $('#pwd-check').val();

    const data = { password };

    await axios
      .delete('/user/delete', { data })
      .then((response) => {
        console.log(response);
        alert(response.data.message);

        window.location.href = '/main';
      })
      .catch((response) => {
        alert(response.response.data.errorMessage);
      });
  });

  let duplicationCheck = true;
  function modify() {
    const beforeNickname = $('#nickname').val();

    $(document).on('click', '#mdf-btn', async function () {
      if (duplicationCheck === true) {
        $('#nickname').removeAttr('readonly');
        $('#nickname').select();

        $('#mdf-btn').text('등록');

        duplicationCheck = false;
      } else {
        const nickname = $('#nickname').val();
        const data = { nickname };

        await axios
          .put('/user/put', { nickname: nickname })
          .then((response) => {
            $('#mdf-btn').text('수정');
            $('#nickname').attr('readonly', '');

            duplicationCheck = true;

            alert(response.data.message);
          })
          .catch((response) => {
            $('#nickname').val(beforeNickname);
            $('#mdf-btn').text('수정');
            $('#nickname').attr('readonly', '');

            duplicationCheck = true;

            alert(response.response.data.errorMessage);
          });
      }
    });

    $(document).on('click', '#logout', async function () {
      await axios
        .post('/auth/logout')
        .then((response) => {
          alert(response.data.message);

          window.location.href = '/main';
        })
        .catch((response) => {
          alert(response.response.data.errorMessage);
        });
    });
  }
</script>
{% endblock %}
